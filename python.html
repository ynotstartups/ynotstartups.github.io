<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Python</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="https://d392viioakuayd.cloudfront.net/public/favicon.webp">
</head>
<body>
<header id="title-block-header">
<h1 class="title">Python</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#python---reference" id="toc-python---reference">Python -
Reference</a></li>
<li><a href="#regular-expression-character-classes-and-atoms"
id="toc-regular-expression-character-classes-and-atoms">regular
expression character classes and atoms</a>
<ul>
<li><a href="#character-classes" id="toc-character-classes">Character
Classes</a></li>
<li><a href="#atoms-special-characters"
id="toc-atoms-special-characters">Atoms / Special Characters</a></li>
</ul></li>
<li><a href="#errors-in-requests" id="toc-errors-in-requests">errors in
<code>Requests</code></a>
<ul>
<li><a href="#catching-requests-errors"
id="toc-catching-requests-errors">Catching requests errors</a></li>
<li><a href="#error-classes-inheritance"
id="toc-error-classes-inheritance">Error Classes Inheritance</a></li>
</ul></li>
<li><a href="#mocking-requests-response-with-no-library"
id="toc-mocking-requests-response-with-no-library">mocking
<code>Requests</code> response with no library</a>
<ul>
<li><a href="#success" id="toc-success">Success</a></li>
<li><a href="#httperror" id="toc-httperror">HTTPError</a></li>
</ul></li>
<li><a href="#python-reminders-function-documentation"
id="toc-python-reminders-function-documentation">Python Reminders#
Function Documentation</a></li>
<li><a href="#script" id="toc-script">script</a></li>
<li><a href="#add-logger" id="toc-add-logger">add logger</a></li>
<li><a href="#test-graphql-endpoint" id="toc-test-graphql-endpoint">test
GraphQL endpoint</a></li>
<li><a href="#django-test-class" id="toc-django-test-class">django test
class</a></li>
<li><a href="#unittest-subtest" id="toc-unittest-subtest">unittest
subtest</a></li>
<li><a href="#test-setuptestdata" id="toc-test-setuptestdata">test
setUpTestData</a></li>
<li><a href="#test-logger" id="toc-test-logger">test logger</a></li>
<li><a href="#test-error-raised" id="toc-test-error-raised">test error
raised</a></li>
<li><a href="#test-freeze-time" id="toc-test-freeze-time">test freeze
time</a></li>
<li><a href="#test-with-override_settings"
id="toc-test-with-override_settings">test with
override_settings</a></li>
<li><a href="#mock-response-success" id="toc-mock-response-success">mock
response success</a></li>
<li><a href="#mock-response-raised-error"
id="toc-mock-response-raised-error">mock response raised error</a></li>
<li><a href="#test-multiple-calls" id="toc-test-multiple-calls">test
multiple calls</a></li>
<li><a href="#test-failure-curocode-doesnt-exists"
id="toc-test-failure-curocode-doesnt-exists">test failure CuroCode
doesn’t exists</a></li>
<li><a href="#handle-raise-for-status"
id="toc-handle-raise-for-status">handle raise for status</a></li>
<li><a href="#catch-all-possible-errors"
id="toc-catch-all-possible-errors">catch all possible errors</a></li>
<li><a href="#graphene---set-required-for-a-list-of-objects"
id="toc-graphene---set-required-for-a-list-of-objects">Graphene - set
required for a list of objects</a></li>
<li><a href="#graphene---set-required-for-a-field"
id="toc-graphene---set-required-for-a-field">Graphene - set required for
a field</a></li>
<li><a href="#use-poetry-lock---no-update"
id="toc-use-poetry-lock---no-update">use
<code>poetry lock --no-update</code></a></li>
<li><a href="#use-python-simple-history"
id="toc-use-python-simple-history">use
<code>python-simple-history</code></a></li>
<li><a href="#debug-in-ssh" id="toc-debug-in-ssh">debug in ssh</a></li>
<li><a
href="#fix-expected-a-value-of-type-globalpermissionenum-but-received"
id="toc-fix-expected-a-value-of-type-globalpermissionenum-but-received">fix
expected a value of type “GlobalPermissionEnum” but received …</a></li>
<li><a href="#get-file-path-to-python-source-codes-in-ipython-with"
id="toc-get-file-path-to-python-source-codes-in-ipython-with">get file
path to python source codes in iPython with <code>??</code></a></li>
<li><a href="#get-celery-ran-tasks" id="toc-get-celery-ran-tasks">get
<code>celery</code> ran tasks</a></li>
<li><a href="#find-the-dependencies-of-python-package"
id="toc-find-the-dependencies-of-python-package">find the dependencies
of python package</a></li>
<li><a href="#profile-performance" id="toc-profile-performance">profile
performance</a>
<ul>
<li><a href="#in-python-cli" id="toc-in-python-cli">In python
cli</a></li>
<li><a href="#in-ipython" id="toc-in-ipython">In iPython</a></li>
<li><a href="#read-output-from-profiler"
id="toc-read-output-from-profiler">Read Output from profiler</a></li>
</ul></li>
<li><a href="#run-black-or-flake8-on-python-code-in-markdown"
id="toc-run-black-or-flake8-on-python-code-in-markdown">run black or
flake8 on python code in markdown</a></li>
<li><a href="#use-pdb-for-debugging" id="toc-use-pdb-for-debugging">use
<code>pdb</code> for debugging</a></li>
<li><a href="#set-timeout-in-requests"
id="toc-set-timeout-in-requests">set timeout in
<code>Requests</code></a></li>
<li><a href="#use-urllib-instead-requests"
id="toc-use-urllib-instead-requests">use urllib instead
<code>Requests</code></a></li>
<li><a href="#use-a-decorator-to-print-function-calls"
id="toc-use-a-decorator-to-print-function-calls">use a decorator to
print function calls</a></li>
<li><a href="#enable-ipython-autoload"
id="toc-enable-ipython-autoload">enable iPython autoload</a></li>
<li><a href="#python---explanation" id="toc-python---explanation">Python
- Explanation</a></li>
<li><a href="#what-is-python-wheel" id="toc-what-is-python-wheel">what
is python wheel?</a></li>
<li><a href="#fileobj-vs-string-vs-bytes"
id="toc-fileobj-vs-string-vs-bytes">fileobj vs string vs bytes</a>
<ul>
<li><a href="#a-computer-can-only-store-bytes"
id="toc-a-computer-can-only-store-bytes">A computer can only store
bytes</a></li>
</ul></li>
</ul>
</nav>
<h1 id="python---reference">Python - Reference</h1>
<h1 id="regular-expression-character-classes-and-atoms">regular
expression character classes and atoms</h1>
<h2 id="character-classes">Character Classes</h2>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 26%" />
<col style="width: 30%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr>
<th>Character classes</th>
<th>Python</th>
<th>Rg</th>
<th>Vim</th>
</tr>
</thead>
<tbody>
<tr>
<td>Word char</td>
<td><code>\w</code></td>
<td>same</td>
<td><code>\w</code></td>
</tr>
<tr>
<td>Space</td>
<td><code>\s</code></td>
<td>same</td>
<td><code>\s</code></td>
</tr>
<tr>
<td>Multiline</td>
<td><code>re.DOTALL</code> / <code>(?s)</code></td>
<td><code>--multiline</code> or <code>(?s)</code></td>
<td><code>\_.</code></td>
</tr>
</tbody>
</table>
<h2 id="atoms-special-characters">Atoms / Special Characters</h2>
<table>
<thead>
<tr>
<th>Atoms</th>
<th>Python</th>
<th>Rg</th>
<th>Vim</th>
</tr>
</thead>
<tbody>
<tr>
<td>zero or more</td>
<td><code>?</code></td>
<td>same</td>
<td><code>?</code></td>
</tr>
<tr>
<td>1 or more</td>
<td><code>+</code></td>
<td>same</td>
<td><code>+</code></td>
</tr>
<tr>
<td>precise number of matches</td>
<td><code>{n,m}</code></td>
<td>same</td>
<td><code>{n,m}</code></td>
</tr>
<tr>
<td>word boundary</td>
<td><code>\b</code></td>
<td>same</td>
<td><code>&lt; &gt;</code></td>
</tr>
<tr>
<td>multiple patterns or</td>
<td><code>|</code></td>
<td>same</td>
<td><code>|</code></td>
</tr>
<tr>
<td>non greedy</td>
<td><code>.*?</code></td>
<td>same</td>
<td><code>.{-}</code></td>
</tr>
<tr>
<td>line starts with</td>
<td><code>^</code></td>
<td>same</td>
<td><code>^</code></td>
</tr>
<tr>
<td>line ends with</td>
<td><code>$</code></td>
<td>same</td>
<td><code>$</code></td>
</tr>
<tr>
<td>group</td>
<td><code>( )</code></td>
<td>same</td>
<td><code>( )</code></td>
</tr>
<tr>
<td>back reference</td>
<td><code>\1 \2 \3</code></td>
<td></td>
<td><code>\1 \2 \3</code></td>
</tr>
<tr>
<td>set start of match</td>
<td></td>
<td></td>
<td><code>\zs</code></td>
</tr>
<tr>
<td>set end of match</td>
<td></td>
<td></td>
<td><code>\ze</code></td>
</tr>
</tbody>
</table>
<p>Example: to match <code>company</code> and <code>companies</code></p>
<ul>
<li>vim: <code>compan\(y\|ies\)</code></li>
<li>rg: <code>compan(y|ies)</code></li>
</ul>
<h1 id="errors-in-requests">errors in <code>Requests</code></h1>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 13%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr>
<th>error type</th>
<th>safe to retry</th>
<th>examples of when error occurs</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTPError - 4xx</td>
<td>No</td>
<td>client error, e.g., calling the api incorrectly</td>
</tr>
<tr>
<td>HTTPError - 5xx</td>
<td>No</td>
<td>server error, e.g. bugs in server code</td>
</tr>
<tr>
<td>Connection Error</td>
<td>Maybe</td>
<td>incorrect configurations or unavailble network</td>
</tr>
<tr>
<td>Connection Timeout</td>
<td>Yes</td>
<td>network congestion, server too busy to responds, server being
offline</td>
</tr>
<tr>
<td>Request Timeout</td>
<td>Maybe</td>
<td>The server did not send any data in the allotted amount of time</td>
</tr>
<tr>
<td>Requests library Exception</td>
<td>No</td>
<td>data passed in cannot be converted to json</td>
</tr>
<tr>
<td>Other Python Exception</td>
<td>No</td>
<td>any python errors</td>
</tr>
</tbody>
</table>
<p>https://requests.readthedocs.io/en/latest/api/#requests.ReadTimeout</p>
<p><strong>See also</strong>: <a
href="https://requests.readthedocs.io/en/latest/api/#exceptions">requests
doc</a></p>
<h2 id="catching-requests-errors">Catching requests errors</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> requests <span class="im">import</span> Timeout, HTTPError</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.post(url, headers<span class="op">=</span>headers, data<span class="op">=</span>data)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    response.raise_for_status()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> HTTPError, Timeout <span class="im">as</span> error:</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span></span></code></pre></div>
<blockquote>
<p>In the event of a network problem (e.g. DNS failure, refused
connection, etc), Requests will raise a ConnectionError exception.
Response.raise_for_status() will raise an HTTPError if the HTTP request
returned an unsuccessful status code. If a request times out, a Timeout
exception is raised. If a request exceeds the configured number of
maximum redirections, a TooManyRedirects exception is raised. All
exceptions that Requests explicitly raises inherit from
requests.exceptions.RequestException.</p>
</blockquote>
<ul>
<li>https://requests.readthedocs.io/en/latest/user/quickstart/#errors-and-exceptions</li>
</ul>
<p>I argue that we should not catch connection error in user facing code
as when the code deployed to prod, the code should not have connection
errors that happens due to incorrect network configs?</p>
<h2 id="error-classes-inheritance">Error Classes Inheritance</h2>
<pre><code>RequestException(IOError)
---&gt; HTTPError(RequestException)
---&gt; ConnectionError(RequestException)
---&gt; Timeout(RequestException)
-------&gt; ConnectTimeout(ConnectionError, Timeout)
-------&gt; ReadTimeout(Timeout)</code></pre>
<ul>
<li>https://requests.readthedocs.io/en/latest/_modules/requests/exceptions/#RequestException</li>
</ul>
<h1 id="mocking-requests-response-with-no-library">mocking
<code>Requests</code> response with no library</h1>
<p>how_to, work,</p>
<h2 id="success">Success</h2>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>json_response <span class="op">=</span> json.dumps(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;url&quot;</span>: <span class="st">&quot;https://fake_bucket_name.aws.com/fake_file_key&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;id&quot;</span>: expected_document_client_portal_id,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>mock_response <span class="op">=</span> Response()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>mock_response.status_code <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>mock_response._content <span class="op">=</span> <span class="bu">bytes</span>(json_response, encoding<span class="op">=</span><span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>mock_requests.post.return_value <span class="op">=</span> mock_response</span></code></pre></div>
<h2 id="httperror">HTTPError</h2>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mock_response <span class="op">=</span> mock.Mock()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>mock_response.raise_for_status.side_effect <span class="op">=</span> HTTPError(<span class="st">&quot;Bad Request&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>mock_requests.post.return_value <span class="op">=</span> mock_response</span></code></pre></div>
<h1 id="python-reminders-function-documentation">Python Reminders#
Function Documentation</h1>
<pre><code>    Args:
        review (int): The first number.
        b (int): The second number.

    Returns:
        int: The sum of the two numbers.

    Raises:
        HTTPError: when call to Calendar API failed</code></pre>
<h1 id="script">script</h1>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python3</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>logging.DEBUG,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    filename<span class="op">=</span><span class="st">&#39;foo.log&#39;</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st">:</span><span class="sc">%(levelname)s</span><span class="st">:</span><span class="sc">%(module)s</span><span class="st">:</span><span class="sc">%(message)s</span><span class="st">&#39;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<h1 id="add-logger">add logger</h1>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>_logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>_logger.error(<span class="st">&quot;foo&quot;</span>, exc_info<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>_logger.exception(<span class="st">&quot;foo&quot;</span>, exc_info<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<h1 id="test-graphql-endpoint">test GraphQL endpoint</h1>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> oneview.tests.graphql <span class="im">import</span> AdminUserMixin, GraphqlTestCase</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> oneview.tests.model_mocks <span class="im">import</span> TodoFactory</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestFoo(AdminUserMixin, GraphqlTestCase):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_bar(<span class="va">self</span>):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        query <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">            mutation query(</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">                $todoTodo: ID!,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">            ) {</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">                todoTodo(</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">                    todoTodo: $todoTodo,</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">                    todoTodo: $todoTodo,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">                ) {</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="st">                    ok</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="st">                    errors</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        variables <span class="op">=</span> {</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;todoTodo&quot;</span>: <span class="st">&quot;todo&quot;</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="va">self</span>.schema.execute(</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            query,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>            variables<span class="op">=</span>variables,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            context_value<span class="op">=</span><span class="va">self</span>.admin_context,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertIsNone(response.errors)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertTrue(response.data[<span class="st">&quot;fooBar&quot;</span>][<span class="st">&quot;ok&quot;</span>])</span></code></pre></div>
<h1 id="django-test-class">django test class</h1>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> django.test <span class="im">import</span> TestCase</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestFoo(TestCase):</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_foo(<span class="va">self</span>):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code></pre></div>
<h1 id="unittest-subtest">unittest subtest</h1>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a, b <span class="kw">in</span> ((<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>), (<span class="st">&quot;baz&quot;</span>, <span class="st">&quot;bazz&quot;</span>)):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="va">self</span>.subTest(a<span class="op">=</span>a, b<span class="op">=</span>b):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(...)</span></code></pre></div>
<h1 id="test-setuptestdata">test setUpTestData</h1>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setUpTestData(cls):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code></pre></div>
<h1 id="test-logger">test logger</h1>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="va">self</span>.assertLogs(<span class="st">&quot;foo.foo.foo&quot;</span>, level<span class="op">=</span><span class="st">&quot;INFO&quot;</span>) <span class="im">as</span> logger_context_manager:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.assertEqual(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    logger_context_manager.output,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;INFO:foo.foo.foo:logger message&quot;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># if using _logger.error(&#39;foo&#39;, exc_info=True)</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># test like this</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.assertIn(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ERROR:foo.foo.foo.foo:Foo&quot;</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    logger_context_manager.output[<span class="dv">0</span>],</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<h1 id="test-error-raised">test error raised</h1>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="va">self</span>.assertRaisesMessage(<span class="pp">ValueError</span>, <span class="st">&quot;invalid literal for int()&quot;</span>):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">ValueError</span>):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
<h1 id="test-freeze-time">test freeze time</h1>
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> freezegun <span class="im">import</span> freeze_time</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytz</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> freeze_time(<span class="st">&quot;2000-01-01T00:00:00&quot;</span>, tz_offset<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: call some function</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.assertEqual(foo, datetime(<span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, tzinfo<span class="op">=</span>pytz.UTC))</span></code></pre></div>
<h1 id="test-with-override_settings">test with override_settings</h1>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> django.test <span class="im">import</span> override_settings</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="at">@override_settings</span>(ENABLE_TRUSTS<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_foo(<span class="va">self</span>):</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
<h1 id="mock-response-success">mock response success</h1>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>json_response <span class="op">=</span> json.dumps(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;url&quot;</span>: <span class="st">&quot;https://fake_bucket_name.aws.com/fake_file_key&quot;</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;id&quot;</span>: expected_document_client_portal_id,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>mock_response <span class="op">=</span> Response()</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>mock_response.status_code <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>mock_response._content <span class="op">=</span> <span class="bu">bytes</span>(json_response, encoding<span class="op">=</span><span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>mock_requests.post.return_value <span class="op">=</span> mock_response</span></code></pre></div>
<h1 id="mock-response-raised-error">mock response raised error</h1>
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mock_response <span class="op">=</span> mock.Mock()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mock_response.raise_for_status.side_effect <span class="op">=</span> HTTPError(<span class="st">&quot;Foo&quot;</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>mock_requests.post.return_value <span class="op">=</span> mock_response</span></code></pre></div>
<h1 id="test-multiple-calls">test multiple calls</h1>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.assertEqual(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    mock_submit_entity.call_args_list,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        call(entity<span class="op">=</span>pot, data<span class="op">=</span>pot.to_curo(), info<span class="op">=</span>mock.ANY),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        call(entity<span class="op">=</span>task, data<span class="op">=</span>task.to_curo(), info<span class="op">=</span>mock.ANY),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<h1 id="test-failure-curocode-doesnt-exists">test failure CuroCode
doesn’t exists</h1>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>oneview.errors.OneViewCuroCodeDoesNotExistError: Curo code does <span class="kw">not</span> exist. CuroCode.get <span class="kw">is</span> called <span class="cf">with</span> args: (), kwargs: {<span class="st">&#39;entity&#39;</span>: <span class="st">&#39;t4a_review&#39;</span>, <span class="st">&#39;field&#39;</span>: <span class="st">&#39;review_reason&#39;</span>, <span class="st">&#39;value&#39;</span>: <span class="st">&#39;Initial client meeting&#39;</span>}</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>CuroCode.objects.create(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    entity<span class="op">=</span><span class="st">&#39;t4a_review&#39;</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    field<span class="op">=</span><span class="st">&#39;review_reason&#39;</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    value<span class="op">=</span><span class="st">&#39;Initial client meeting&#39;</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<h1 id="handle-raise-for-status">handle raise for status</h1>
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.post(url, headers<span class="op">=</span>headers, data<span class="op">=</span>json.dumps(data))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    response.raise_for_status()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> HTTPError <span class="im">as</span> error:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    _logger.exception(error)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> FooBar(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        errors<span class="op">=</span>[<span class="ss">f&quot;foo bar&quot;</span>],</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        ok<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<h1 id="catch-all-possible-errors">catch all possible errors</h1>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> requests <span class="im">import</span> RequestException</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(url,timeout<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    r.raise_for_status()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> RequestException <span class="im">as</span> error:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    _logger.exception(error)</span></code></pre></div>
<h1 id="graphene---set-required-for-a-list-of-objects">Graphene - set
required for a list of objects</h1>
<p><code>required=True</code> and <code>NonNull</code></p>
<ul>
<li><code>required=True</code> means that the itself must not be
null.</li>
</ul>
<p><code>risk_profiles = graphene.List(graphene.NonNull(lambda: RiskProfileType), required=True)</code></p>
<ul>
<li><code>graphene.NonNull</code> means that each risk profile cannot be
null.</li>
<li><code>required=True</code> means that the list itself must not be
null.</li>
</ul>
<p>Translate to graphql schema
<code>riskProfiles: [RiskProfileType!]!</code></p>
<h1 id="graphene---set-required-for-a-field">Graphene - set required for
a field</h1>
<p><code>review = graphene.Field(ReviewType, required=True)</code> #
Python - How To</p>
<h1 id="use-poetry-lock---no-update">use
<code>poetry lock --no-update</code></h1>
<p>after you manually edited <code>pyproject.toml</code>, run
<code>poetry lock --no-update</code> to only update lock file without
updating dependencies.</p>
<h1 id="use-python-simple-history">use
<code>python-simple-history</code></h1>
<p>how_to, python,</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> review.history.<span class="bu">all</span>():</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i.history_change_reason, i.date_updated)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_history_changes(obj):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    history <span class="op">=</span> obj.history.order_by(<span class="st">&#39;history_date&#39;</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    fields <span class="op">=</span> [f.name <span class="cf">for</span> f <span class="kw">in</span> obj._meta.fields]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(history)):</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        old <span class="op">=</span> history[i<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        new <span class="op">=</span> history[i]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">--- Change at: </span><span class="sc">{</span>new<span class="sc">.</span>history_date<span class="sc">}</span><span class="ss"> by </span><span class="sc">{</span>new<span class="sc">.</span>history_user<span class="sc">}</span><span class="ss"> ---&quot;</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> field <span class="kw">in</span> fields:</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>            old_val <span class="op">=</span> <span class="bu">getattr</span>(old, field)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            new_val <span class="op">=</span> <span class="bu">getattr</span>(new, field)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> old_val <span class="op">!=</span> new_val:</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>field<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>old_val<span class="sc">!r}</span><span class="ss"> → </span><span class="sc">{</span>new_val<span class="sc">!r}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<h1 id="debug-in-ssh">debug in ssh</h1>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first shell</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># somehow this is needed for `ipdb` to run correctly</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="op">%</span>pdb</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># first shell</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="im">import</span> pdb</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pdb.runcall(function_foo, ...<span class="bu">any</span> args <span class="kw">and</span> kwargs)</span></code></pre></div>
<h1
id="fix-expected-a-value-of-type-globalpermissionenum-but-received">fix
expected a value of type “GlobalPermissionEnum” but received …</h1>
<p>how_to, work,</p>
<pre><code>docker exec --env -t oneview-django-1 poetry run python manage.py refresh_all_permissions</code></pre>
<h1 id="get-file-path-to-python-source-codes-in-ipython-with">get file
path to python source codes in iPython with <code>??</code></h1>
<p>in iPython</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> requests</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> requests??</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> this</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> this??</span></code></pre></div>
<h1 id="get-celery-ran-tasks">get <code>celery</code> ran tasks</h1>
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> django_celery_results.models <span class="im">import</span> TaskResult</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get tasks by recency</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>task_result <span class="op">=</span> TaskResult.objects.order_by(<span class="st">&#39;-date_created&#39;</span>)[:<span class="dv">5</span>]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> task_result:</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">vars</span>(i))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get failed tasks</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>task_result <span class="op">=</span> TaskResult.objects.<span class="bu">filter</span>(status<span class="op">=</span><span class="st">&#39;FAILURE&#39;</span>).order_by(<span class="st">&#39;date_done&#39;</span>)[:<span class="dv">10</span>]</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> task_result:</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">vars</span>(i))</span></code></pre></div>
<h1 id="find-the-dependencies-of-python-package">find the dependencies
of python package</h1>
<p>Two ways</p>
<ol type="1">
<li>Go into a shell with the dependencies installed</li>
</ol>
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">1</span>]:  <span class="im">from</span> importlib.metadata <span class="im">import</span> requires</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">2</span>]: requires(<span class="st">&#39;Django&#39;</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">2</span>]:</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;asgiref (&lt;4,&gt;=3.3.2)&#39;</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;pytz&#39;</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;sqlparse (&gt;=0.2.2)&#39;</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a> <span class="st">&quot;argon2-cffi (&gt;=19.1.0) ; extra == &#39;argon2&#39;&quot;</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a> <span class="st">&quot;bcrypt ; extra == &#39;bcrypt&#39;&quot;</span>]</span></code></pre></div>
<ol start="2" type="1">
<li>Read the poetry.lock file</li>
</ol>
<pre><code>[[package]]
name = &quot;django&quot;
version = &quot;3.2.20&quot;
description = &quot;A high-level Python Web framework that encourages rapid development and clean, pragmatic design.&quot;
optional = false
python-versions = &quot;&gt;=3.6&quot;
files = [
    {file = &quot;Django-3.2.20-py3-none-any.whl&quot;, hash = &quot;sha256:a477ab326ae7d8807dc25c186b951ab8c7648a3a23f9497763c37307a2b5ef87&quot;},
    {file = &quot;Django-3.2.20.tar.gz&quot;, hash = &quot;sha256:dec2a116787b8e14962014bf78e120bba454135108e1af9e9b91ade7b2964c40&quot;},
]

[package.dependencies]
asgiref = &quot;&gt;=3.3.2,&lt;4&quot;
pytz = &quot;*&quot;
sqlparse = &quot;&gt;=0.2.2&quot;

[package.extras]
argon2 = [&quot;argon2-cffi (&gt;=19.1.0)&quot;]
bcrypt = [&quot;bcrypt&quot;]</code></pre>
<h1 id="profile-performance">profile performance</h1>
<h2 id="in-python-cli">In python cli</h2>
<pre><code>... python -m cProfile -o stats ...</code></pre>
<h2 id="in-ipython">In iPython</h2>
<p><strong><code>%%prun -r</code> returns profiling object</strong></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>prun <span class="op">-</span>D stats</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> oneview.models.helpers.imports <span class="im">import</span> pull_accounts_no_threaded</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>pull_accounts_no_threaded()</span></code></pre></div>
<h2 id="read-output-from-profiler">Read Output from profiler</h2>
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pstats</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read profile output from a file called `stats`</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> pstats.Stats(<span class="st">&#39;stats&#39;</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># starts with Cumulative time to get a sense of the time taken,</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># try to spot unexpected time spent and large number of function calls</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>stats.sort_stats(<span class="st">&#39;cumtime&#39;</span>).print_stats(<span class="dv">100</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># `tottime` for the total time spent in the given function (and excluding time</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># made in calls to sub-functions)</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>stats.sort_stats(<span class="st">&#39;tottime&#39;</span>).print_stats(<span class="dv">100</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>stats.sort_stats(<span class="st">&#39;filename&#39;</span>).print_stats(<span class="dv">100</span>)</span></code></pre></div>
<p><strong>Alternatively, Just timeit once</strong></p>
<pre><code>%%timeit -n 1 -r 1

from oneview.models.helpers.imports import pull_accounts, pull_accounts_no_threaded
pull_accounts()</code></pre>
<p>See also - <a
href="https://docs.python.org/3/library/profile.html#pstats.Stats.sort_stats">pstat
sort keys</a> - <a
href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-prun">%prun
documentation</a> - <a
href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-timeit">%timeit
documentation</a></p>
<h1 id="run-black-or-flake8-on-python-code-in-markdown">run black or
flake8 on python code in markdown</h1>
<p>generalised to any files</p>
<ol type="1">
<li><code>vic</code> visual select lines of python codes in markdown
code block</li>
<li><code>:'&lt;,'&gt;!black -q -</code> to replace the visually
selected lines with the formatted standard output of the external
<code>black</code> command (see <code>:help filter</code>)</li>
<li><code>:'&lt;,'&gt;w !flake8 -</code> to use <code>w</code> to echo
flake8’s output instead of replacing visually selected lines (see
<code>:help :w_c</code>)</li>
</ol>
<p><strong>Alternatively, I can open the output in a split</strong></p>
<ol type="1">
<li><code>:'&lt;,'&gt;w !flake8 - &gt; quickfix.vim</code> to pipe the
output into <code>quickfix.vim</code></li>
<li><code>&lt;leader&gt;el</code></li>
</ol>
<h1 id="use-pdb-for-debugging">use <code>pdb</code> for debugging</h1>
<p><strong>Debugging after ssh into uat</strong></p>
<p><strong>Prerequisite</strong></p>
<p>Go into the ipython shell
e.g. <code>sudo docker exec -it oneview-django poetry run python manage.py shell</code></p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">1</span>]: <span class="im">from</span> oneview.graphql.api.charge <span class="im">import</span> one_fee_calculator</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">2</span>]: review_id <span class="op">=</span> <span class="st">&quot;73a07db5-7214-4ead-a9b8-4906e1727a8c&quot;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">3</span>]: <span class="im">import</span> pdb</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        pdb.runcall(one_fee_calculator, review_id)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="op">/</span>app<span class="op">/</span>backend<span class="op">/</span>oneview<span class="op">/</span>graphql<span class="op">/</span>api<span class="op">/</span>charge.py(<span class="dv">248</span>)one_fee_calculator()</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="op">-&gt;</span> review <span class="op">=</span> Review.objects.get(<span class="bu">id</span><span class="op">=</span>review_id)</span></code></pre></div>
<p>If you do the above, you will be dropped into the pdb debugging
shell.</p>
<p>Note: please be careful about possible side effects if the functions
called especially if you are doing this in uat or even prod
environment.</p>
<p><strong>pdb</strong></p>
<p>pdb is an interactive source code debugger for Python programs.</p>
<p><a
href="https://docs.python.org/3/library/pdb.html#module-pdb">pdb</a> is
very powerful, though you need to get familiar with the commands</p>
<p>You can find the pdb commands doc <a
href="https://docs.python.org/3/library/pdb.html#debugger-commands">here</a></p>
<p>Most useful commands I find are</p>
<ul>
<li><code>ll</code> - print all source code for the current function or
frame</li>
<li><code>b</code> - breakpoint, you can set breakpoint like so
<code>b oneview/graphql/api/charge.py:254</code></li>
<li><code>c</code> - continue, continue until breakpoint</li>
<li><code>n</code> - next, continue execution until the next line</li>
<li><code>s</code> - step, step inside a function</li>
<li><code>sticky</code> - show whole function while you are debugging,
make pdb very much like debugging with GUI</li>
</ul>
<h1 id="set-timeout-in-requests">set timeout in
<code>Requests</code></h1>
<pre class="python3"><code># timeout = (connect timeout, read timeout)
requests.get(&#39;https://github.com&#39;, timeout=(3, 27))</code></pre>
<blockquote>
<p>By default, requests do not time out unless a timeout value is set
explicitly. Without a timeout, your code may hang for minutes or more.
It’s a good practice to set connect timeouts to slightly larger than a
multiple of 3, which is the default TCP packet retransmission window.
Doc from requests</p>
</blockquote>
<h1 id="use-urllib-instead-requests">use urllib instead
<code>Requests</code></h1>
<p>POST with json data</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>json_as_bytes <span class="op">=</span> json.dumps(payload).encode(<span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>request_object <span class="op">=</span> request.Request(<span class="va">self</span>.api_url, data<span class="op">=</span>json_as_bytes)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>request_object.add_header(<span class="st">&quot;Content-Type&quot;</span>, <span class="st">&quot;application/json&quot;</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>request_object.add_header(<span class="st">&quot;Authorization&quot;</span>, <span class="ss">f&quot;Bearer </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>token<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> request.urlopen(request_object) <span class="im">as</span> response:</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        res_json <span class="op">=</span> json.loads(response.read())</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> HTTPError <span class="im">as</span> e:</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    _logger.exception(e.code)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    _logger.exception(e.read())</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> e</span></code></pre></div>
<p>See Also: <a
href="https://docs.python.org/3.12/howto/urllib2.html">urllib2
doc</a></p>
<h1 id="use-a-decorator-to-print-function-calls">use a decorator to
print function calls</h1>
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_function_name(func):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _print_function_name(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;--&gt; begin:  </span><span class="sc">{</span>func<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;--&gt; return: </span><span class="sc">{</span>func<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _print_function_name</span></code></pre></div>
<h1 id="enable-ipython-autoload">enable iPython autoload</h1>
<p>reload modules when user executes code, so that I don’t need to exit
ipython shell to reload edited code.</p>
<pre><code>%load_ext autoreload
%autoreload 2</code></pre>
<h1 id="python---explanation">Python - Explanation</h1>
<h1 id="what-is-python-wheel">what is python wheel?</h1>
<p><strong>output for installing source distribution (not
wheel)</strong></p>
<p>downloading tar.gz and building wheel</p>
<pre><code>&gt; python -m pip install &#39;uwsgi==2.0.*&#39;

Collecting uwsgi==2.0.*
  Downloading uwsgi-2.0.22.tar.gz (809 kB)
     ---------------------------------------- 809.7/809.7 kB 13.4 MB/s eta 0:00:00
  Preparing metadata (setup.py) ... done
Building wheels for collected packages: uwsgi
  Building wheel for uwsgi (setup.py) ... done
  Created wheel for uwsgi: filename=uWSGI-2.0.22-cp311-cp311-macosx_13_0_arm64.whl size=400536 sha256=a79b882b505a3093feed13f859dfa01e1ce04651abd125d418509505bc861d94
  Stored in directory: /Users/yuhao.huang/Library/Caches/pip/wheels/93/59/2d/d21852a9f9607e9494b5d3c96d11f348d11039f7c47223c9ce
Successfully built uwsgi
Installing collected packages: uwsgi
Successfully installed uwsgi-2.0.22</code></pre>
<p><strong>output for installing wheel</strong></p>
<p>there’s no build stage when pip finds a compatible wheel on PyPI.</p>
<pre><code>&gt; python -m pip install &#39;chardet==3.*&#39;
Collecting chardet==3.*
  Downloading chardet-3.0.4-py2.py3-none-any.whl (133 kB)
     ---------------------------------------- 133.4/133.4 kB 4.8 MB/s eta 0:00:00
Installing collected packages: chardet
Successfully installed chardet-3.0.4
</code></pre>
<p>A Python .whl file is essentially a ZIP (.zip) archive with a
specially crafted filename that tells installers what Python versions
and platforms the wheel will support.</p>
<p><code>{dist}-{version}(-{build})?-{python}-{abi}-{platform}.whl</code></p>
<p><code>cryptography-2.9.2-cp35-abi3-macosx_10_9_x86_64.whl</code></p>
<h1 id="fileobj-vs-string-vs-bytes">fileobj vs string vs bytes</h1>
<ul>
<li>string/character string
<ul>
<li>‘abc’</li>
<li>a sequence of Unicode code points that represent textual characters
from human languages</li>
</ul></li>
<li>bytes
<ul>
<li>b’abc’</li>
<li>a sequence of 8 bits unsigned values</li>
<li>literal binary data</li>
</ul></li>
<li>fileobj
<ul>
<li>BytesIO(‘abc’) or BytesIO(b’abc’)</li>
<li>an file like object that implements <code>.read()</code></li>
</ul></li>
</ul>
<h2 id="a-computer-can-only-store-bytes">A computer can only store
bytes</h2>
<p>See this <a href="https://stackoverflow.com/a/31322359">stackoverflow
answer</a></p>
</body>
</html>
